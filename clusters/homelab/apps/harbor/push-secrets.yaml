# Push admin credentials to Vault
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: harbor-admin-push
  namespace: harbor
spec:
  refreshInterval: "1h"
  secretStoreRefs:
  - name: vault-backend
    kind: SecretStore
  selector:
    secret:
      name: harbor-admin
  data:
  - match:
      secretKey: username
      remoteRef:
        remoteKey: harbor/admin
        property: username
  - match:
      secretKey: password
      remoteRef:
        remoteKey: harbor/admin
        property: password
---
# Push database password to Vault
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: harbor-database-push
  namespace: harbor
spec:
  refreshInterval: "1h"
  secretStoreRefs:
  - name: vault-backend
    kind: SecretStore
  selector:
    secret:
      name: harbor-database
  data:
  - match:
      secretKey: password
      remoteRef:
        remoteKey: harbor/database
        property: password
---
# Push registry credentials to Vault
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: harbor-registry-push
  namespace: harbor
spec:
  refreshInterval: "1h"
  secretStoreRefs:
  - name: vault-backend
    kind: SecretStore
  selector:
    secret:
      name: harbor-registry
  data:
  - match:
      secretKey: username
      remoteRef:
        remoteKey: harbor/registry
        property: username
  - match:
      secretKey: password
      remoteRef:
        remoteKey: harbor/registry
        property: password
---
# Push registry user credentials to Vault
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: harbor-registry-user-push
  namespace: harbor
spec:
  refreshInterval: "1h"
  secretStoreRefs:
  - name: vault-backend
    kind: SecretStore
  selector:
    secret:
      name: harbor-registry-user
  data:
  - match:
      secretKey: username
      remoteRef:
        remoteKey: harbor/registry-user
        property: username
  - match:
      secretKey: password
      remoteRef:
        remoteKey: harbor/registry-user
        property: password
---
# Push htpasswd to Vault
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: harbor-htpasswd-push
  namespace: harbor
spec:
  refreshInterval: "1h"
  secretStoreRefs:
  - name: vault-backend
    kind: SecretStore
  selector:
    secret:
      name: harbor-registry-htpasswd
  data:
  - match:
      secretKey: htpasswd
      remoteRef:
        remoteKey: harbor/registry-htpasswd
        property: htpasswd
---
# Push OVH credentials to Vault
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: ovh-credentials-push
  namespace: harbor
spec:
  refreshInterval: "1h"
  secretStoreRefs:
  - name: vault-backend
    kind: SecretStore
  selector:
    secret:
      name: ovh-credentials
  data:
  - match:
      secretKey: endpoint
      remoteRef:
        remoteKey: ovh/harbor
        property: endpoint
  - match:
      secretKey: applicationKey
      remoteRef:
        remoteKey: ovh/harbor
        property: applicationKey
  - match:
      secretKey: applicationSecret
      remoteRef:
        remoteKey: ovh/harbor
        property: applicationSecret
  - match:
      secretKey: consumerKey
      remoteRef:
        remoteKey: ovh/harbor
        property: consumerKey