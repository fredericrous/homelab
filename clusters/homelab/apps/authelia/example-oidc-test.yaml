---
# Example OIDC client configuration for testing the Kyverno automation
# This file demonstrates how to create an OIDC client config that will
# automatically trigger the assembly and Authelia restart process
#
# To test the automation:
# 1. Apply this ConfigMap: kubectl apply -f example-oidc-test.yaml
# 2. Watch for the Kyverno-triggered job: kubectl get jobs -n authelia -w
# 3. Monitor the assembly process: kubectl logs -f job/oidc-assembly-test-* -n authelia
# 4. Verify Authelia restart: kubectl get pods -n authelia -w
# 5. Clean up: kubectl delete configmap test-app-oidc-client-config -n authelia
#
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-app-oidc-client-config
  namespace: authelia
  labels:
    app.kubernetes.io/component: oidc-client
    app.kubernetes.io/part-of: authelia
    app.kubernetes.io/name: test-app
  annotations:
    description: "Test OIDC client configuration for Kyverno automation testing"
    docs: "https://www.authelia.com/integration/openid-connect/"
data:
  test-client.yaml: |
    - client_id: test-app
      client_name: Test Application
      client_secret: '$pbkdf2-sha512$310000$test-secret-placeholder$test-hashed-secret'
      public: false
      authorization_policy: two_factor
      redirect_uris:
        - https://test-app.daddyshome.fr/oauth/callback
        - https://test-app.daddyshome.fr/auth/callback
      scopes:
        - openid
        - profile
        - groups
        - email
      response_types:
        - code
      grant_types:
        - authorization_code
      response_modes:
        - form_post
        - query
        - fragment
      userinfo_signed_response_alg: none