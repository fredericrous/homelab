# Pull admin credentials from Vault (after PushSecret)
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: nextcloud-admin
  namespace: nextcloud
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: SecretStore
    name: vault-backend
  target:
    name: nextcloud-admin
    creationPolicy: Owner
  dataFrom:
    - extract:
        key: secret/data/nextcloud/admin
---
# Pull database configuration from Vault (after PushSecret)
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: nextcloud-db
  namespace: nextcloud
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: SecretStore
    name: vault-backend
  target:
    name: nextcloud-db
    creationPolicy: Owner
    template:
      data:
        database: "{{ .name | toString }}"
        username: "{{ .user | toString }}"
        password: "{{ .password | toString }}"
        host: "{{ .host | toString }}"
        port: "{{ .port | toString }}"
  dataFrom:
    - extract:
        key: secret/data/nextcloud/database
---
# Pull LDAP configuration from Vault (after PushSecret)
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: nextcloud-ldap
  namespace: nextcloud
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: SecretStore
    name: vault-backend
  target:
    name: nextcloud-ldap
    creationPolicy: Owner
  dataFrom:
    - extract:
        key: secret/data/nextcloud/ldap