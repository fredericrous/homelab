apiVersion: ceph.rook.io/v1
kind: CephCluster
metadata:
  name: rook-ceph
  namespace: rook-ceph
spec:
  cephVersion:
    image: quay.io/ceph/ceph:v19.2.3
  dataDirHostPath: /var/lib/rook
  skipUpgradeChecks: false
  continueUpgradeAfterChecksEvenIfNotHealthy: false
  cleanupPolicy:
    sanitizeDisks:
      method: quick
    allowUninstallWithVolumes: true
  mon:
    count: 3
    allowMultiplePerNode: false
  mgr:
    count: 2
    allowMultiplePerNode: true
    modules:
    - name: rook
      enabled: true
  dashboard:
    enabled: true
    ssl: true
  network:
    hostNetwork: false
  # Placement configuration
  placement:
    all:
      tolerations:
      - key: node-role.kubernetes.io/control-plane
        operator: Exists
        effect: NoSchedule
    mon:
      tolerations:
      - key: node-role.kubernetes.io/control-plane
        operator: Exists
        effect: NoSchedule
      # Remove anti-affinity for small cluster to allow flexible scheduling
    mgr:
      tolerations:
      - key: node-role.kubernetes.io/control-plane
        operator: Exists
        effect: NoSchedule
    # OSDs should only run on worker nodes
    osd:
      tolerations: []
  storage:
    useAllNodes: true
    useAllDevices: false
    deviceFilter: "sdb"
    config:
      osdsPerDevice: "1"
  # Reduced resources for small cluster
  resources:
    mgr:
      limits:
        memory: "1Gi"
      requests:
        cpu: "100m"
        memory: "512Mi"
    mon:
      limits:
        memory: "2Gi"
      requests:
        cpu: "100m"
        memory: "1Gi"
    osd:
      limits:
        memory: "4Gi"
      requests:
        cpu: "200m"  # Reduced from 1000m
        memory: "2Gi"
