apiVersion: v1
kind: ConfigMap
metadata:
  name: nextcloud-config
  namespace: nextcloud
data:
  # PHP configuration
  php.ini: |
    upload_max_filesize=10G
    post_max_size=10G
    max_input_time=3600
    max_execution_time=3600
    memory_limit=512M

  # Apache configuration
  apache-pretty-urls.conf: |
    <IfModule mod_rewrite.c>
      RewriteEngine on
      RewriteRule ^\.well-known/carddav /remote.php/dav/ [R=301,L]
      RewriteRule ^\.well-known/caldav /remote.php/dav/ [R=301,L]
      RewriteRule ^\.well-known/webfinger /index.php/.well-known/webfinger [R=301,L]
      RewriteRule ^\.well-known/nodeinfo /index.php/.well-known/nodeinfo [R=301,L]
    </IfModule>

  # Nextcloud configuration
  custom.config.php: |
    <?php
    $CONFIG = array (
      'memcache.local' => '\\OC\\Memcache\\APCu',
      'overwriteprotocol' => 'https',
      'overwrite.cli.url' => 'https://nextcloudx.daddyshome.fr',
      'htaccess.RewriteBase' => '/',
      'default_phone_region' => 'FR',
      'log_type' => 'file',
      'logfile' => '/var/www/html/data/nextcloud.log',
      'loglevel' => 2,
      'maintenance_window_start' => 1,
    );
