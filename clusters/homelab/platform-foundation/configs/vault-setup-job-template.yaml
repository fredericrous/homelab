---
# Base template for Vault setup jobs
# This should be used as a base for app-specific vault setup
apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-setup-script-template
  namespace: flux-system
data:
  setup.sh: |
    #!/bin/sh
    set -e

    echo "🔐 Setting up Vault secrets for ${APP_NAME}..."

    # Wait for Vault to be ready
    until vault status >/dev/null 2>&1; do
      echo "Waiting for Vault to be initialized..."
      sleep 5
    done

    # Get Vault token from mounted secret
    export VAULT_TOKEN=$(cat /vault/token)
    export VAULT_ADDR=http://vault-vault.vault.svc.cluster.local:8200

    # App-specific setup should go here
    # This will be overridden by each app
