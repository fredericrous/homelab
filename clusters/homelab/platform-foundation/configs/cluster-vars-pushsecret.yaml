---
# PushSecret to dynamically migrate all cluster-vars from k8s to Vault KV2
# This bulk-migrates all bootstrap secrets to secret/data/cluster-vars
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: cluster-vars-to-vault
  namespace: flux-system
spec:
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  selector:
    secret:
      name: cluster-vars
  # Use dataFrom to dynamically push all keys from cluster-vars
  dataFrom:
    - key: secret/data/cluster-vars