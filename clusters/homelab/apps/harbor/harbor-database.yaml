# Declarative database creation for Harbor
apiVersion: postgresql.cnpg.io/v1
kind: Database
metadata:
  name: harbor
  namespace: postgres
spec:
  name: harbor
  owner: harbor
  cluster:
    name: postgres-apps
  ensure: present
  databaseReclaimPolicy: retain
  # CloudNativePG GitOps Pattern:
  # 1. Managed role 'harbor' is defined in postgres-apps-cluster.yaml spec.managed.roles
  # 2. CloudNativePG operator reconciles managed roles first (creates user with password)
  # 3. Then Database resource references the existing role as owner
  # 4. The harbor-db-app secret must exist in postgres namespace (via reflector)
  # 
  # The operator handles dependency ordering - roles before databases.
  # If this Database shows "cannotReconcile", check managed role status:
  # kubectl describe cluster postgres-apps -n postgres