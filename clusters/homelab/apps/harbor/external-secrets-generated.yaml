# Harbor admin secret with generated password
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: harbor-admin-generated
  namespace: harbor
spec:
  refreshInterval: "0"  # Never refresh (password shouldn't change)
  target:
    name: harbor-admin
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        # Harbor expects a key called "secret" for the admin password
        secret: "{{ .password }}"
        username: "admin"
        password: "{{ .password }}"
  dataFrom:
  - sourceRef:
      generatorRef:
        apiVersion: generators.external-secrets.io/v1alpha1
        kind: Password
        name: harbor-admin-password
---
# Harbor database secret with generated password
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: harbor-database-generated
  namespace: harbor
spec:
  refreshInterval: "0"
  target:
    name: harbor-database
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        password: "{{ .password }}"
  dataFrom:
  - sourceRef:
      generatorRef:
        apiVersion: generators.external-secrets.io/v1alpha1
        kind: Password
        name: harbor-database-password
---
# Harbor registry secret with generated password
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: harbor-registry-generated
  namespace: harbor
spec:
  refreshInterval: "0"
  target:
    name: harbor-registry
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        username: "_registry_user"
        password: "{{ .password }}"
        htpasswd: ""  # Empty for now, will be populated later
  dataFrom:
  - sourceRef:
      generatorRef:
        apiVersion: generators.external-secrets.io/v1alpha1
        kind: Password
        name: harbor-registry-password
---
# Harbor registry user secret with generated password
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: harbor-registry-user-generated
  namespace: harbor
spec:
  refreshInterval: "0"
  target:
    name: harbor-registry-user
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        username: "stremio"
        password: "{{ .password }}"
  dataFrom:
  - sourceRef:
      generatorRef:
        apiVersion: generators.external-secrets.io/v1alpha1
        kind: Password
        name: harbor-registry-user-password
---
# Harbor registry htpasswd (empty for now)
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: harbor-registry-htpasswd-generated
  namespace: harbor
spec:
  refreshInterval: "0"
  target:
    name: harbor-registry-htpasswd
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        htpasswd: ""
  data: []  # Empty data array to satisfy validation
---
# OVH credentials from hardcoded values
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: ovh-credentials-static
  namespace: harbor
spec:
  refreshInterval: "0"
  target:
    name: ovh-credentials
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        endpoint: "ovh-eu"
        applicationKey: "a4598a81b100e759"
        applicationSecret: "2066396e3b624e34d4f1a3d009ca0139"
        consumerKey: "cb8d03d3d3a2de55f9df196190022425"
  data: []  # No external data source, all data is in the template