# Policy for External Secrets Operator with full capabilities for PushSecret
apiVersion: redhatcop.redhat.io/v1alpha1
kind: Policy
metadata:
  name: external-secrets-operator
  namespace: vault-config-operator
spec:
  authentication:
    path: kubernetes
    role: controller-manager
    serviceAccount:
      name: controller-manager
  policy: |
    # Read all secrets (for ExternalSecret)
    path "secret/data/*" {
      capabilities = ["read", "list"]
    }
    
    # Write secrets (for PushSecret)
    path "secret/data/*" {
      capabilities = ["create", "update", "patch", "delete"]
    }
    
    # List and manage metadata (for PushSecret)
    path "secret/metadata/*" {
      capabilities = ["read", "list", "create", "update", "delete"]
    }
    
    # Auth token lookup (required for self-service)
    path "auth/token/lookup-self" {
      capabilities = ["read"]
    }
    
    # Transit operations (if using transit secrets engine)
    path "transit/*" {
      capabilities = ["read"]
    }
  type: acl