apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  # HelmRepositories (must be first)
  - jetstack.yaml
  - external-secrets.yaml  
  - emberstack.yaml
  - rook-release.yaml
  - hashicorp.yaml
  - fredericrous.yaml
  # Essential operators
  - reflector.yaml
  - rook-ceph.yaml
  - external-secrets-operator.yaml
  - cert-manager.yaml
  - vault-transit-unseal-operator.yaml

  # Istio namespaces (must be before Istio components)
  - istio-namespaces.yaml
  
  # Istio core (required for mesh)
  - istio-repository.yaml
  - istio-base.yaml
  - istio-cni.yaml
  - istio-istiod.yaml
  - istio-eastwest-gateway.yaml  # Deploy before ztunnel for proper authentication
  - istio-ztunnel.yaml
  - istio-sa-fix.yaml

configMapGenerator:
  - name: homelab-istio-eastwest-values
    namespace: flux-system
    files:
      - values.yaml=istio-eastwest-values.yaml

generatorOptions:
  disableNameSuffixHash: true
