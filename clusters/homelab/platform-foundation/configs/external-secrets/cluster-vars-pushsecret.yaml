---
# PushSecret to dynamically migrate all cluster-vars from k8s to Vault KV2
# This bulk-migrates all bootstrap secrets to secret/data/cluster-vars
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: cluster-vars-to-vault
  namespace: flux-system
spec:
  updatePolicy: Replace           # or IfNotExists
  deletionPolicy: Delete          # or Retain
  refreshInterval: 10m
  secretStoreRefs:
    - kind: ClusterSecretStore
      name: vault-backend
  selector:
    secret:
      name: cluster-vars          # your source k8s Secret
  data:
    - match:
        remoteRef:
          remoteKey: cluster-vars   # Vault KV v2 path
